package testeditor.view.test.view.actions.controlpanel;

import testeditor.Test;
import testeditor.contoller.Question;
import testeditor.view.frame.view.MainFrame;
import testeditor.model.QListModel;
import testeditor.view.test.view.TestView;
import testeditor.contoller.XMLFile;

import javax.swing.*;
import javax.swing.filechooser.FileNameExtensionFilter;
import java.awt.*;
import java.awt.event.ActionEvent;


public class OpenTestAction extends AbstractAction {
    private JList<Question> qList;

    public OpenTestAction(JList<Question> qList) {

        this.qList = qList;

        this.putValue(Action.NAME, "Открыть");
        this.putValue(Action.SHORT_DESCRIPTION, "Открыть файл теста");
        this.putValue(Action.SMALL_ICON, UIManager.getIcon("FileView.directoryIcon"));
    }

    public void actionPerformed(ActionEvent event) {
        Test.getTest().clear();
        ((DefaultListModel) qList.getModel()).clear();
        QListModel listModel = (QListModel) qList.getModel();
        listModel.removeAllElements();

        JFileChooser openDialog = new JFileChooser();
        openDialog.setFileFilter(new FileNameExtensionFilter(".xml", "xml"));

        UIManager.put("FileChooser.cancelButtonText", "Отмена");
        UIManager.put("FileChooser.cancelButtonToolTipText", "Отмена");
        SwingUtilities.updateComponentTreeUI(openDialog);

        MainFrame parentFrame = (MainFrame) SwingUtilities.getRoot((Component) event.getSource());
        int result = openDialog.showDialog(parentFrame, "Открыть файл");
        if (result == JFileChooser.APPROVE_OPTION) {

            new XMLFile(openDialog.getSelectedFile().getPath(), (DefaultListModel<Question>) qList.getModel()).read();

            qList.setSelectedIndex(0);

            TestView testView = (TestView) (qList.getParent().getParent().getParent());
            testView.getEditPanel().setVisible(true);
            testView.getControlPanel().getSaveAsButton().setEnabled(true);
            parentFrame.setTitle(openDialog.getSelectedFile().getName());
        }
    }
}